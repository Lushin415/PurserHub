# ParserHub ‚Äî –û—Ä–∫–µ—Å—Ç—Ä–æ–≤—ã–π Telegram –ë–æ—Ç

Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞:
- **workers_service** (–ø–æ—Ä—Ç 8002) ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Telegram —á–∞—Ç–æ–≤ –ü–í–ó
- **avito_cian_parser** (–ø–æ—Ä—Ç 8001) ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ Avito/Cian

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤**
- –ü–∞—Ä—Å–µ—Ä –ü–í–ó (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–∞—Ç–æ–≤)
- –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π Pyrogram

‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ü–í–ó**
- –†–µ–∂–∏–º—ã: —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ / —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–∏
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º, —Ü–µ–Ω–∞–º, –®–ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏—è—Ö

‚úÖ **–ü–∞—Ä—Å–∏–Ω–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏**
- Avito
- Cian
- Avito + Cian –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü

‚úÖ **–ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ @username
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏ –ß–°
- –ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ

‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- –û—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è –ü–í–ó
- –û—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Chat ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository_url>
cd PurserHub
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env`:

```env
# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ ParserHub (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
BOT_TOKEN=your_bot_token_here

# Telegram API (my.telegram.org)
API_ID=your_api_id
API_HASH=your_api_hash

# –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (–¥–ª—è Docker –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
WORKERS_SERVICE_URL=http://workers_service:8002
REALTY_SERVICE_URL=http://avito_cian_parser:8001

# –ü—É—Ç–∏ (–¥–ª—è Docker –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /shared/sessions)
DB_PATH=parserhub.db
SESSIONS_DIR=./sessions
LOG_PATH=parserhub.log
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# –∏–ª–∏
.venv\Scripts\activate     # Windows

pip install -r requirements.txt
```

### 4. –ó–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
python -m parserhub.bot
```

## Docker

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
docker-compose up -d
```

### –õ–æ–≥–∏

```bash
docker-compose logs -f parserhub
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker-compose down
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
parserhub/
‚îú‚îÄ‚îÄ bot.py                  # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª, –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ config.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ .env
‚îú‚îÄ‚îÄ db_service.py           # SQLite –ë–î
‚îú‚îÄ‚îÄ models.py               # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ api_client.py           # HTTP –∫–ª–∏–µ–Ω—Ç—ã –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º
‚îú‚îÄ‚îÄ session_manager.py      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Pyrogram —Å–µ—Å—Å–∏—è–º–∏
‚îî‚îÄ‚îÄ handlers/
    ‚îú‚îÄ‚îÄ start.py            # /start, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    ‚îú‚îÄ‚îÄ auth.py             # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (2 —Å–µ—Å—Å–∏–∏)
    ‚îú‚îÄ‚îÄ settings.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    ‚îú‚îÄ‚îÄ workers.py          # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ü–í–ó
    ‚îú‚îÄ‚îÄ realty.py           # –ü–∞—Ä—Å–∏–Ω–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
    ‚îî‚îÄ‚îÄ blacklist.py        # –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

SQLite –±–∞–∑–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏:
- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- `user_settings` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ç–æ–∫–µ–Ω—ã –±–æ—Ç–æ–≤, chat ID)
- `active_tasks` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## API –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

### workers_service (–ø–æ—Ä—Ç 8002)

- `POST /workers/start` ‚Äî –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `GET /workers/status/{task_id}` ‚Äî —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
- `POST /workers/stop/{task_id}` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- `POST /blacklist/check?username=@user` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ß–°
- `GET /blacklist/chats` ‚Äî —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ß–°
- `POST /blacklist/chats/add` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —á–∞—Ç –≤ –ß–°
- `POST /blacklist/chats/remove` ‚Äî —É–¥–∞–ª–∏—Ç—å —á–∞—Ç –∏–∑ –ß–°

### avito_cian_parser (–ø–æ—Ä—Ç 8001)

- `POST /parse/start` ‚Äî –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
- `GET /parse/status/{task_id}` ‚Äî —Å—Ç–∞—Ç—É—Å –ø–∞—Ä—Å–∏–Ω–≥–∞
- `POST /parse/stop/{task_id}` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

## –†–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏—è–º–∏

–ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç **–¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Å—Å–∏–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- `{user_id}_parser.session` ‚Äî –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ü–í–ó
- `{user_id}_blacklist.session` ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ß–°

–°–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `./sessions/` (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ `/shared/sessions/` (Docker volume).

–ü—Ä–∏—á–∏–Ω–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è: –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É —Å–µ—Å—Å–∏—é –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ @BotFather
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞: `/newbot`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω
4. –ü–æ–ª—É—á–∏—Ç–µ Chat ID:
   - –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start`
   - –û—Ç–∫—Ä–æ–π—Ç–µ: `https://api.telegram.org/bot<TOKEN>/getUpdates`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `chat.id`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –±–æ—Ç–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ ParserHub –±–æ—Ç–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏**
3. –í—ã–±–µ—Ä–∏—Ç–µ **üë∑ –ë–æ—Ç –¥–ª—è –ü–í–ó** –∏–ª–∏ **üè† –ë–æ—Ç –¥–ª—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏**
4. –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ Chat ID

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- SQLite
- Telegram Bot Token
- Telegram API credentials (api_id, api_hash)

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
